<x-layouts.app> <div class="min-h-screen bg-gray-50"> <!-- Header --> <div class="bg-gradient-to-r from-primary-400 to-teal-light-400 text-white py-8"> <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8"> <h1 class="text-4xl font-bold mb-2">Manage Your Booking</h1> <p class="text-xl text-white/90">Reference: {{ $booking->booking_reference }}</p> </div> </div> <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8"> <!-- Success/Error Messages --> @if (session('success')) <div class="mb-6 bg-green-50 border-l-4 border-green-500 p-4 -r"> <div class="flex"> <svg class="w-6 h-6 text-green-500 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/> </svg> <p class="text-green-800 font-semibold">{{ session('success') }}</p> </div> </div> @endif @if ($errors->any()) <div class="mb-6 bg-red-50 border-l-4 border-red-500 p-4 -r"> <div class="flex"> <svg class="w-6 h-6 text-red-500 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/> </svg> <div> @foreach ($errors->all() as $error) <p class="text-red-800">{{ $error }}</p> @endforeach </div> </div> </div> @endif <!-- Booking Status --> <div class="bg-white shadow-lg p-6 mb-6"> <div class="flex items-center justify-between mb-6"> <h2 class="text-2xl font-bold text-gray-900">Booking Status</h2> @if ($booking->status === 'confirmed') <span class="bg-green-100 text-green-800 px-4 py-2 font-bold text-sm"> ✓ Confirmed </span> @else <span class="bg-red-100 text-red-800 px-4 py-2 font-bold text-sm"> ✗ Cancelled </span> @endif </div> <!-- Event Details --> <div class="space-y-4"> <div> <h3 class="text-2xl font-bold text-gray-900">{{ $booking->event->title }}</h3> </div> <div class="flex items-start"> <svg class="w-5 h-5 text-primary-600 mr-3 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/> </svg> <div> <p class="font-semibold text-gray-900">{{ $booking->event->start_datetime->format('l, j F Y') }}</p> <p class="text-gray-700">{{ $booking->event->start_datetime->format('g:i A') }} - {{ $booking->event->end_datetime->format('g:i A') }}</p> </div> </div> <div class="flex items-start"> <svg class="w-5 h-5 text-primary-600 mr-3 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/> </svg> <div> <p class="font-semibold text-gray-900">{{ $booking->event->location->name }}</p> <p class="text-gray-700">{{ $booking->event->location->address }}</p> </div> </div> </div> </div> <!-- Booking Details --> <div class="bg-white shadow-lg p-6 mb-6"> <h2 class="text-xl font-bold text-gray-900 mb-4">Booking Details</h2> <div class="space-y-4"> <!-- Reference --> <div class="flex justify-between py-2 border-b"> <span class="text-gray-700 font-semibold">Reference</span> <span class="font-mono font-bold text-gray-900">{{ $booking->booking_reference }}</span> </div> <!-- Attendee --> <div class="flex justify-between py-2 border-b"> <span class="text-gray-700 font-semibold">Attendee</span> <span class="text-gray-900">{{ $booking->attendee_name }}</span> </div> <div class="flex justify-between py-2 border-b"> <span class="text-gray-700 font-semibold">Email</span> <span class="text-gray-900">{{ $booking->attendee_email }}</span> </div> <!-- Tickets --> <div class="py-2"> <p class="text-gray-700 font-semibold mb-2">Tickets</p> <div class="space-y-1 ml-4"> @if ($booking->adult_tickets > 0) <p class="text-gray-700">Adult × {{ $booking->adult_tickets }}</p> @endif @if ($booking->child_tickets > 0) <p class="text-gray-700">Child × {{ $booking->child_tickets }}</p> @endif @if ($booking->concession_tickets > 0) <p class="text-gray-700">Concession × {{ $booking->concession_tickets }}</p> @endif <p class="font-semibold text-gray-900 pt-1">Total: {{ $booking->total_tickets }} ticket(s)</p> </div> </div> @if ($booking->event->is_paid) <div class="flex justify-between py-2 border-b"> <span class="text-gray-700 font-semibold">Amount Paid</span> <span class="font-bold text-gray-900 text-lg">£{{ number_format($booking->total_amount, 2) }}</span> </div> @endif @if ($booking->accessibility_notes) <div class="py-2"> <p class="text-gray-700 font-semibold mb-1">Accessibility Notes</p> <p class="text-gray-700 bg-gray-50 p-3">{{ $booking->accessibility_notes }}</p> </div> @endif @if ($booking->status === 'cancelled') <div class="py-2 border-t"> <p class="text-gray-700 font-semibold mb-1">Cancellation Details</p> <p class="text-gray-700">Cancelled on: {{ $booking->cancelled_at->format('j F Y, g:i A') }}</p> @if ($booking->refund_amount > 0) <p class="text-green-700 font-semibold mt-1">Refund: £{{ number_format($booking->refund_amount, 2) }}</p> @endif </div> @endif </div> </div> <!-- Calendar Links --> @if ($booking->status === 'confirmed') <div class="bg-white shadow-lg p-6 mb-6"> <h2 class="text-xl font-bold text-gray-900 mb-4">Add to Calendar</h2> <div class="grid sm:grid-cols-2 gap-3"> <a href="{{ route('events.booking.calendar', ['booking' => $booking->id, 'type' => 'google']) }}" target="_blank" class="flex items-center justify-center bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 transition"> <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"> <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V9h14v10zm0-12H5V5h14v2z"/> </svg> Google Calendar </a> <a href="{{ route('events.booking.calendar', ['booking' => $booking->id, 'type' => 'ical']) }}" class="flex items-center justify-center bg-secondary-500 hover:bg-secondary-600 text-gray-900 font-bold py-3 px-4 transition"> <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"> <path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11z"/> </svg> Download iCal </a> </div> <!-- Get Directions --> <div class="mt-6 pt-6 border-t border-gray-200"> <h3 class="font-semibold text-gray-900 mb-3 flex items-center"> <svg class="w-5 h-5 text-teal-light-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/> </svg> Get Directions </h3> <div class="flex gap-2"> <input type="text" id="startAddress" placeholder="Type your address" class="flex-1 px-4 py-3 border border-gray-300 focus:ring-2 focus:ring-teal-light-500 focus:border-transparent"> <button onclick="getDirections()" class="bg-gradient-to-r from-teal-light-400 to-teal-light-500 hover:from-teal-light-500 hover:to-teal-light-600 text-white font-bold px-6 py-3 transition shadow-md hover:shadow-lg whitespace-nowrap"> <svg class="w-5 h-5 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/> </svg> Go </button> </div> </div> <script> function getDirections() { const startAddress = document.getElementById('startAddress').value.trim(); const destination ="London Road, Northampton, NN4 8AW"; if (!startAddress) { alert('Please enter your starting address'); return; } const mapsUrl = `https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(startAddress)}&destination=${encodeURIComponent(destination)}`; window.open(mapsUrl, '_blank'); } // Allow Enter key to submit document.getElementById('startAddress').addEventListener('keypress', function(e) { if (e.key === 'Enter') { getDirections(); } }); </script> </div> @endif <!-- Cancellation Section --> @if ($booking->status === 'confirmed') <div class="bg-white shadow-lg p-6"> <h2 class="text-xl font-bold text-gray-900 mb-4">Cancellation</h2> @if ($booking->can_be_cancelled) <!-- Can Cancel --> <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4 -r"> <h3 class="font-bold text-blue-900 mb-2">Cancellation Policy</h3> <div class="text-blue-800 text-sm space-y-1"> @if ($booking->event->is_paid) <p>• Cancel more than 24 hours before: <span class="font-bold">100% refund</span></p> <p>• Cancel within 24 hours: <span class="font-bold">50% refund</span></p> @php $refundPercentage = $booking->refund_percentage; $refundAmount = ($booking->total_amount * $refundPercentage) / 100; @endphp <p class="pt-2 font-bold text-blue-900"> If you cancel now, you'll receive a {{ $refundPercentage }}% refund (£{{ number_format($refundAmount, 2) }}) </p> @else <p>You can cancel this free booking at any time up to 24 hours before the event.</p> @endif </div> </div> <!-- Cancel Button --> <button onclick="showCancelModal()" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 transition"> Cancel This Booking </button> @else <!-- Cannot Cancel --> <div class="bg-gray-50 border-l-4 border-gray-400 p-4 -r"> <p class="text-gray-700"> <svg class="w-5 h-5 inline mr-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/> </svg> <span class="font-semibold">This booking can no longer be cancelled.</span> </p> <p class="text-gray-600 text-sm mt-2">Cancellations are only allowed up to 24 hours before the event start time.</p> </div> @endif </div> @endif <!-- Back to Events --> <div class="text-center mt-8"> <a href="{{ route('events') }}" class="inline-block text-teal-light-500 hover:text-primary-700 font-semibold text-lg hover:underline"> ← Back to Events </a> </div> </div> </div> <!-- Cancel Confirmation Modal --> @if ($booking->status === 'confirmed' && $booking->can_be_cancelled) <div id="cancelModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"> <div class="bg-white shadow-2xl max-w-md w-full p-6"> <h3 class="text-2xl font-bold text-gray-900 mb-4">Cancel Booking?</h3> <p class="text-gray-700 mb-6">Are you sure you want to cancel this booking? This action cannot be undone.</p> @if ($booking->event->is_paid) @php $refundPercentage = $booking->refund_percentage; $refundAmount = ($booking->total_amount * $refundPercentage) / 100; @endphp <div class="bg-green-50 border-l-4 border-green-500 p-4 mb-6"> <p class="text-green-800 font-semibold"> You will receive a {{ $refundPercentage }}% refund of £{{ number_format($refundAmount, 2) }} </p> <p class="text-green-700 text-sm mt-1">Refund will be processed within 5-7 business days</p> </div> @endif <form method="POST" action="{{ route('events.booking.cancel', $booking->id) }}"> @csrf <div class="mb-4"> <label for="reason" class="block text-gray-700 font-semibold mb-2"> Reason for cancellation (optional) </label> <textarea name="reason" id="reason" rows="3" class="w-full px-3 py-2 border border-gray-300 focus:border-primary-600 focus:ring-2 focus:ring-primary-200" placeholder="Let us know why you're cancelling..."></textarea> </div> <div class="flex gap-3"> <button type="submit" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 transition"> Yes, Cancel Booking </button> <button type="button" onclick="hideCancelModal()" class="flex-1 border-2 border-gray-300 hover:border-gray-400 text-gray-700 font-bold py-3 px-4 transition"> Keep Booking </button> </div> </form> </div> </div> <script> function showCancelModal() { document.getElementById('cancelModal').classList.remove('hidden'); } function hideCancelModal() { document.getElementById('cancelModal').classList.add('hidden'); } // Close modal on ESC key document.addEventListener('keydown', function(e) { if (e.key === 'Escape') { hideCancelModal(); } }); // Close modal on outside click document.getElementById('cancelModal')?.addEventListener('click', function(e) { if (e.target === this) { hideCancelModal(); } }); </script> @endif
</x-layouts.app>
